<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create a Runtime for Serving Containerised R Functions on AWS Lambda • lambdr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Create a Runtime for Serving Containerised R Functions on AWS Lambda">
<meta property="og:description" content="Runtime for serving containers that can execute R code on the 
    AWS Lambda serverless compute service &lt;https://aws.amazon.com/lambda/&gt;.
    Provides the necessary functionality for handling the various endpoints
    required for accepting new input and sending responses.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">lambdr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/api-gateway-invocations.html">API Gateway Invocations</a>
    </li>
    <li>
      <a href="articles/context.html">Using invocation context</a>
    </li>
    <li>
      <a href="articles/eventbridge-and-sns-invocations.html">EventBridge and SNS Invocations</a>
    </li>
    <li>
      <a href="articles/lambda-runtime-in-container.html">Placing an R Lambda Runtime in a Container</a>
    </li>
    <li>
      <a href="articles/package-structure.html">Package Structure</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mdneuzerling/lambdr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="lambdr-">lambdr <img src="reference/figures/lambdr.png" style="height:200px;"><a class="anchor" aria-label="anchor" href="#lambdr-"></a>
</h1></div>
<!-- badges: start -->
<p>This package provides an R runtime for the <a href="https://aws.amazon.com/lambda/" class="external-link"><em>AWS Lambda</em> serverless compute service</a>. It is intended to be used to create containers that can run on <em>AWS Lambda</em>. <code>lambdr</code> provides the necessary functionality for handling the various endpoints required for accepting new input and sending responses.</p>
<p>This package is <strong>unofficial</strong>. Its creators are not affiliated with <em>Amazon Web Services</em>, nor is its content endorsed by <em>Amazon Web Services</em>. <em>Lambda</em>, <em>API Gateway</em>, <em>EventBridge</em>, <em>CloudWatch</em>, and <em>SNS</em> are services of <em>Amazon Web Services</em>.</p>
<p>The default behaviour is to convert the body of the received event from JSON into arguments for the handler function using the <code>jsonlite</code> package. For example, a raw event body of <code>{"number": 9}</code> will be converted to <code>list(number = 9)</code>. The handler function will then receive the arguments directly after unlisting, eg. <code>number = 9</code>. This works for direct invocations, as well as situations where the user wishes to implement behaviour specific to a trigger.</p>
<p>Some invocation types have their own logic for converting the event body into an R object. This is useful for say, using an R function in a Lambda behind an API Gateway, so that the R function does not need to deal with the HTML elements of the invocation. The below invocation types have custom logic implemented. Refer to the vignettes or the package website for more information.</p>
<p>Alternatively, user-defined functions can be provided for parsing event content and serialising results. The user can also use the <code>identity</code> function as a deserialiser to pass the raw event content — as a string — to the handler function. Refer to <code><a href="reference/lambda_config.html">?lambda_config</a></code> for more information.</p>
<table class="table">
<thead><tr class="header">
<th align="left">invocation type</th>
<th align="left">implementation stage</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">direct</td>
<td align="left"><img src="reference/figures/lifecycle-stable.svg"></td>
</tr>
<tr class="even">
<td align="left">API Gateway (REST)</td>
<td align="left"><img src="reference/figures/lifecycle-experimental.svg"></td>
</tr>
<tr class="odd">
<td align="left">API Gateway (HTML)</td>
<td align="left"><img src="reference/figures/lifecycle-experimental.svg"></td>
</tr>
<tr class="even">
<td align="left">EventBridge</td>
<td align="left"><img src="reference/figures/lifecycle-experimental.svg"></td>
</tr>
<tr class="odd">
<td align="left">SNS</td>
<td align="left"><img src="reference/figures/lifecycle-experimental.svg"></td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>When the package is made available on CRAN it can be installed with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"lambdr"</span><span class="op">)</span></span></code></pre></div>
<p>The development version is available with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"mdneuzerling/lambdr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running">Running<a class="anchor" aria-label="anchor" href="#running"></a>
</h2>
<p>In a <code>runtime.R</code> file, source all functions needed and then run:</p>
<pre class="{r}"><code><span><span class="fu">lambdr</span><span class="fu">::</span><span class="fu"><a href="reference/start_lambda.html">start_lambda</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>This <code>runtime.R</code> file should be executed by the Docker image containing your Lambda code.</p>
<p>The <code><a href="reference/start_lambda.html">lambdr::start_lambda()</a></code> function relies on environment variables configured by AWS. It will fail if run locally. In particular, the <em>handler</em> as configured by the user through AWS will determine which function handles the Lambda events. For debugging and testing, values can be provided to the function in the absence of environment variables. See <code><a href="reference/lambda_config.html">?lambdr::lambda_config</a></code> for details.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Consider the following <code>runtime.R</code> file:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parity</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">number</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parity <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="st">"even"</span> <span class="kw">else</span> <span class="st">"odd"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">lambdr</span><span class="fu">::</span><span class="fu"><a href="reference/start_lambda.html">start_lambda</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The <code>parity</code> function accepts a <code>number</code> argument and returns its parity as a named list, for example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">parity</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># $parity</span></span>
<span><span class="co"># [1] "odd"</span></span>
<span></span>
<span></span>
<span><span class="fu">parity</span><span class="op">(</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="co"># $parity</span></span>
<span><span class="co"># [1] "even"</span></span></code></pre></div>
<p>This function can then be placed into a Docker image. An <strong>example</strong> is provided below, but the key components are:</p>
<ul>
<li>Start from the <code>public.ecr.aws/lambda/provided</code> parent image, which provides the basic components necessary to serve a Lambda</li>
<li>Install R and dependencies, both system dependencies and R packages, including the <code>lambdr</code> package</li>
<li>Copy across <code>runtime.R</code> and any other necessary files</li>
<li>Generate a simple bootstrap which runs <code>runtime.R</code> with R</li>
<li>Set the handler as the <code>CMD</code>. The <code>lambdr</code> package interprets the handler as the name of the function to use, in this case, “parity”. The <code>CMD</code> can also be set (or overriden) when setting up the Lambda in AWS.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">FROM</span> public.ecr.aws/lambda/provided</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="kw">ENV</span> R_VERSION=4.0.3</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a><span class="kw">RUN</span> yum -y install wget git tar</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a><span class="kw">RUN</span> yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm \</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>  &amp;&amp; wget https://cdn.rstudio.com/r/centos-7/pkgs/R-${R_VERSION}-1-1.x86_64.rpm \</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>  &amp;&amp; yum -y install R-${R_VERSION}-1-1.x86_64.rpm \</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>  &amp;&amp; rm R-${R_VERSION}-1-1.x86_64.rpm</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a><span class="kw">ENV</span> PATH=<span class="st">"${PATH}:/opt/R/${R_VERSION}/bin/"</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a><span class="co"># System requirements for R packages</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a><span class="kw">RUN</span> yum -y install openssl-devel</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a><span class="kw">RUN</span> Rscript -e <span class="st">"install.packages(c('httr', 'jsonlite', 'logger', 'remotes'), repos = 'https://packagemanager.rstudio.com/all/__linux__/centos7/latest')"</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a><span class="kw">RUN</span> Rscript -e <span class="st">"remotes::install_github('mdneuzerling/lambdr')"</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a><span class="kw">RUN</span> mkdir /lambda</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a><span class="kw">COPY</span> runtime.R /lambda</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a><span class="kw">RUN</span> chmod 755 -R /lambda</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a><span class="kw">RUN</span> printf <span class="st">'#!/bin/sh\ncd /lambda\nRscript runtime.R'</span> &gt; /var/runtime/bootstrap \</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a>  &amp;&amp; chmod +x /var/runtime/bootstrap</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true"></a><span class="kw">CMD</span> [<span class="st">"parity"</span>]</span></code></pre></div>
<p>The image is built and uploaded to AWS Elastic Container Registry (ECR). First, a repository is created:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="ex">aws</span> ecr create-repository --repository-name parity-lambda --image-scanning-configuration scanOnPush=true</span></code></pre></div>
<p>This provides a URI, the resource identifier of the created repository. The image can now be pushed:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="ex">docker</span> tag mdneuzerling/r-on-lambda:latest <span class="dt">{URI}</span>/parity-lambda:latest</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="ex">aws</span> ecr get-login-password <span class="kw">|</span> <span class="ex">docker</span> login --username AWS --password-stdin <span class="dt">{URI}</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="ex">docker</span> push <span class="dt">{URI}</span>/parity-lambda:latest</span></code></pre></div>
<p>In either the AWS console or the command line, a Lambda can be created from this image. Call the Lambda “parity” to match the function name. Tests can be executed within the console. Alternatively the Lambda can be invoked from the CLI:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="ex">aws</span> lambda invoke --function-name parity <span class="kw">\</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>  <span class="ex">--invocation-type</span> RequestResponse --payload <span class="st">'{"number": 8}'</span> <span class="kw">\</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>  <span class="ex">/tmp/response.json</span> --cli-binary-format raw-in-base64-out</span></code></pre></div>
<p>The output is now available in the generated file:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="fu">cat</span> /tmp/response.json            </span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="dt">{"parity":"even"}</span></span></code></pre></div>
<hr>
<p>Hex logo by Phizz Leeder</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=lambdr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/mdneuzerling/lambdr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mdneuzerling/lambdr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing lambdr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>David Neuzerling <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/mdneuzerling/lambdr/actions" class="external-link"><img src="https://github.com/mdneuzerling/lambdr/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://cran.r-project.org/package=lambdr" class="external-link"><img src="https://www.r-pkg.org/badges/version/lambdr" alt="CRAN status"></a></li>
<li><a href="https://cran.r-project.org/package=lambdr" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/lambdr" alt="CRAN downloads"></a></li>
<li><a href="https://github.com/mdneuzerling/lambdr/tree/main" class="external-link"><img src="https://img.shields.io/github/last-commit/mdneuzerling/lambdr/main.svg" alt="Last commit"></a></li>
<li><a href="https://app.codecov.io/gh/mdneuzerling/lambdr?branch=main" class="external-link"><img src="https://codecov.io/gh/mdneuzerling/lambdr/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://choosealicense.com/licenses/mit/" class="external-link"><img src="https://img.shields.io/badge/license-MIT-lightgrey.svg" alt="license"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by David Neuzerling.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
